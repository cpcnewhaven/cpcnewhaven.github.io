<!DOCTYPE html>
<html lang="en">
    <head>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description"
            content="CPC New Haven Church - 135 Whitney Ave New Haven, CT. We are a church committed to serving and reaching the Greater New Haven area. Join us for worship and fellowship.">
        <meta name="keywords"
            content="CPC New Haven, Church, New Haven, CT, Worship, Fellowship">
        <meta name="author" content="CPC New Haven">
        <title>Live - CPC New Haven Church</title>
        <link rel="stylesheet" href="./src/css/global-body.css">
        <link rel="stylesheet" href="./src/css/global-footer-cta.css">
        <link rel="stylesheet" href="./src/css/footer.css">
        <link rel="stylesheet" href="./css/podcasts.css">
        <link rel="stylesheet" href="./src/css/global-nav-bar.css">
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
        <style>
            .wwb-content {
                display: flex;
                flex-direction: column;
                align-items: center;
                margin-top: 20px;
            }

            .wwbclass-list-number {
                margin-right: 10px;
            }

            .wwbclass-play-button {
                background-color: #1DB954;
                color: white;
                border: none;
                padding: 5px 10px;
                margin-left: 10px;
                cursor: pointer;
            }

            .wwbclass-play-button:hover {
                background-color: #1ED760;
            }

            @media (max-width: 767px) {
                .submenu-container {
                    display: none;
                }
            }

            .search-container {
                margin: 20px auto;
                max-width: 600px;
            }

            #podcastSearchInput {
                width: 100%;
                padding: 10px;
                font-size: 16px;
            }

            #searchResults {
                margin-top: 10px;
            }

            .search-result {
                padding: 10px;
                border-bottom: 1px solid #eee;
                cursor: pointer;
            }

            .search-result:hover {
                background-color: #f5f5f5;
            }

            /* Sidebar styles */
            .dashboard-container {
                display: flex;
            }

            .sidebar {
                width: 220px;
                background-color: #f4f4f4;
                padding: 20px;
                box-shadow: 2px 0 5px rgba(0,0,0,0.1);
                position: fixed;
                height: 100vh;
            }

            .sidebar h1 {
                font-size: 2rem!important;
            }

            .sidebar-logo {
                width: 100px; /* Adjust the size as needed */
                display: block;
                margin: 0 auto 20px auto; /* Center the logo and add bottom margin */
            }

            .sidebar h1, .sidebar h2 {
                text-align: center; /* Center align the headings */
            }

            .sidebar ul {
                list-style-type: none;
                padding: 0;
            }

            .sidebar ul li {
                margin: 10px 0;
            }

            .sidebar ul li a {
                text-decoration: none;
                color: #333;
                font-size: 1.1em;
            }

            .main-content {
                flex-grow: 1;
                padding: 20px;
                margin-left: 250px;
            }

            @media (max-width: 768px) {
                .sidebar {
                    width: 100%;
                    height: auto;
                    position: relative;
                    box-shadow: none;
                }

                .main-content {
                    margin-left: 0;
                }

                .dashboard-container {
                    flex-direction: column;
                }
            }
        </style>
    </head>
    <body>

        <header id="stickyHeader" class="sticky">
            <nav class="main-navigation">
                <a href="index.html">Home</a>
                <a href="sundays.html">Sundays</a>
                <a href="about.html">About</a>
                <a href="podcasts.html">Podcasts</a>
                <a href="events.html">Events</a>
                <a href="announcements.html">Announcements</a>
                <a href="community.html">Community</a>
                <a href="live.html">Live</a>
                <a href="resources.html">Resources</a>
                <a href="give.html">Give</a>
            </nav>
        </header>

        <div class="hamburger-menu-button-container" id="hamburgerMenu">
            <i id="closeMobileMenuButton" class="fas fa-bars"></i>
        </div>

        <!-- Mobile Navigation -->
        <div class="mobile-navigation" id="mobileNavigation">
            <i id="closeMenuButton" class="fas fa-bars"></i>
            <!-- Exit button -->
            <img src="./assets/CPC_LOGO_24.png" id="mobile-menu-logo">
            <a class="mobile-menu-link" href="index.html">Home</a>
            <a class="mobile-menu-link" href="sundays.html">Sundays</a>
            <a class="mobile-menu-link" href="about.html">About</a>
            <a class="mobile-menu-link" href="podcasts.html">Podcasts</a>
            <a class="mobile-menu-link" href="events.html">Events</a>
            <a class="mobile-menu-link"
                href="announcements.html">Announcements</a>
            <a class="mobile-menu-link" href="community.html">Community</a>
            <a class="mobile-menu-link" href="live.html">Live</a>
            <a class="mobile-menu-link" href="resources.html">Resources</a>
            <a class="mobile-menu-link" href="give.html">Give</a>
        </div>

        <div class="dashboard-container">
            <!-- Sidebar -->
            <div class="sidebar fixed-sidebar">
                <img src="./assets/CPC_LOGO_24.png" class="sidebar-logo">
                <h1>Podcasts</h1>

                <h2>Table of Contents</h2>
                <ul>
                    <li><a href="#podcast-sunday-sermon">The Sunday
                            Sermon</a></li>
                    <li><a href="#podcast-beyond">Beyond</a></li>
                    <li><a href="#podcast-adult-study">Adult Sunday
                            Studies</a></li>
                </ul>
                <hr>
                <div class="search-container"
                    style="max-width: 200px; margin:0 auto;">
                    <input type="text" id="podcastSearchInput"
                        placeholder="Search podcasts...">
                    <div id="searchResults"></div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">

                <div class="top-splash-welcome">
                    <br>
                    <h1 class="headline">Podcasts</h1>
                    <br>
                    <hr>

                </div>

                <img src="./assets/websiteBG-podcasts/1.jpg"
                    style="width: 100%; height: auto;">

                <div
                    style="background-color: rgb(255, 251, 0); width: 100%; padding: 10px; text-align: center;">
                    <p><span style="font-weight: bold;">Warning:</span> This
                        website is in beta mode and may not work as expected -
                        to view the old podcast website please visit <a
                            href="https://podcasts.cpcnewhaven.org"
                            style="text-decoration: underline;">here</a></p>
                </div>
                <section id="podcast-sunday-sermon" class="inner-page-section"
                    style="margin-top:20px;">
                    <h2>The Sunday Sermon</h2>
                    <table id="sunday-sermon-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Title</th>
                                <th>Speaker</th>
                                <th>Scripture</th>
                                <th>Listen</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Table content will be dynamically populated here -->
                        </tbody>
                    </table>
                </section>

                <script>
                document.addEventListener('DOMContentLoaded', function() {
                    fetch('data/podcast-index.json')
                        .then(response => response.json())
                        .then(data => {
                            const sundaySermons = data.sundaySermons.episodes;
                            const tableBody = document.querySelector('#sunday-sermon-table tbody');

                            // Sort the sermons by date in descending order (latest first)
                            sundaySermons.sort((a, b) => new Date(b.date) - new Date(a.date));

                            sundaySermons.forEach(sermon => {
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td>${formatDate(sermon.date)}</td>
                                    <td>${sermon.title}</td>
                                    <td>${sermon.author}</td>
                                    <td>${sermon.scripture}</td>
                                    <td><a href="${sermon.spotify_url}" target="_blank">Listen on Spotify</a></td>
                                `;
                                tableBody.appendChild(row);
                            });
                        })
                        .catch(error => console.error('Error fetching podcast data:', error));
                });

                function formatDate(dateString) {
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    return new Date(dateString).toLocaleDateString('en-US', options);
                }
                </script>

                <section id="podcast-beyond" class="inner-page-section">
                    <h2>Beyond</h2>
                    <!-- Content for Beyond -->
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/0bI7PF4LL0725GwbvP3Fq0?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/1HTxyUoV1PIs9fjCfdT7Hc?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/00kiP5VJhqXCe27EQ0iRd8?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/6yBjpPq8wy2DpodduC2fCO?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/5AlCPKfjUx7qPjCdRv3nYa?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/4TU0k8lmF3JWsZvVs6by5E?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/4Vu3BzlVeHWZomA1dUTkmz?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/6VjK8hT8rv4YmdZvNpDtz6?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/1GuvtpLTTZRjsmGQqQghnF?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/0JgjQq3VeTQQCFvjxbnXSF?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/4jxBlMNYnk8nznuuZ3uTnK?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/episode/2LEsA2a9c5NG11FEOKGo6O?utm_source=generator"
                        width="100%" height="352" frameBorder="0"
                        allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"></iframe>

                </section>

                <section id="podcast-adult-study" class="inner-page-section">
                    <h2 id="wwbclass-title"></h2>
                    <div class="wwb-content">
                        <ul id="wwbclass-episode-list" class="list-table">
                            <!-- Episodes will be populated here by JavaScript -->
                        </ul>
                    </div>
                </section>

            </div>
        </div>
        <section>
            <div class="center-content">
                <h2>Subscribe</h2>
                <div class="subscribe-icons-a">
                    <a
                        href="https://open.spotify.com/show/22kjUJyC0VH3cMfCSe9kEk?si=843112804a664618"
                        target="_blank"><i
                            class="fab fa-spotify"></i></a>
                    <a href="your_apple_podcasts_link" target="_blank"><i
                            class="fab fa-apple"></i></a>
                    <a href="https://www.youtube.com/@CPCNewHaven"
                        target="_blank"><i
                            class="fab fa-youtube"></i></a>
                </div></div>
        </section>
        <section class="splash-image" id="mid-image"></section>
        <section id="footer-cta-a" class="styled-section-a">
            <div class="form-container">
                <h2>Subscribe to our Newsletter</h2>
                <p class="body-text">Stay Connected with the Latest and Greatest
                    from
                    CPC New Haven</p>
                <form action="https://formspree.io/f/meojowwg" method="POST"
                    class="neumorphic-form">
                    <input type="text" name="name" placeholder="Your name"
                        required>
                    <!-- Added name input -->
                    <input type="email" name="email" placeholder="Your email"
                        required>
                    <button type="submit">Subscribe to CPC New Haven</button>
                </form>
            </div>
        </section>
        <footer>
            <a id="fixedlink" target="_blank" rel="nofollow noopener"
                href="#">135 Whitney Ave - New Haven, CT | Sunday Worship
                10:30am </a>
        </footer>
        <script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('podcastSearchInput');
    const searchResults = document.getElementById('searchResults');
    const sundaySermonSection = document.getElementById('podcast-sunday-sermon');
    let allPodcasts = [];

    // Fetch all podcast data
    Promise.all([
        fetch('data/podcast/total-podcast.json').then(response => response.json()),
        fetch('data/podcast/preAprilPodcast.csv').then(response => response.text()),
        fetch('data/podcast/podcast-sunday-sermon.json').then(response => response.json()) // Fetch Sunday Sermon JSON
    ])
    .then(([totalPodcastData, preAprilPodcastCSV, sundaySermonData]) => {
        allPodcasts = totalPodcastData;
        
        // Parse CSV data
        Papa.parse(preAprilPodcastCSV, {
            header: true,
            complete: function(results) {
                allPodcasts = allPodcasts.concat(results.data.map(episode => ({
                    title: episode.Name,
                    dateReleased: episode['Date Released'],
                    bibleReference: episode['Bible Reference'],
                    episodeLink: episode['Episode Link'],
                    artwork: episode.Cover
                })));
                
                // Set up search functionality
                searchInput.addEventListener('input', performSearch);
            }
        });

        // Display Sunday Sermon episodes
        displaySundaySermonEpisodes(sundaySermonData);
    })
    .catch(error => console.error('Error loading podcast data:', error));

    function performSearch() {
        const query = searchInput.value.toLowerCase();
        const results = allPodcasts.filter(podcast => 
            podcast.title.toLowerCase().includes(query) ||
            podcast.bibleReference.toLowerCase().includes(query)
        );

        displayResults(results);
    }

    function displayResults(results) {
        searchResults.innerHTML = '';
        results.slice(0, 5).forEach(podcast => {
            const resultElement = document.createElement('div');
            resultElement.classList.add('search-result');
            resultElement.innerHTML = `
                <strong>${podcast.title}</strong><br>
                ${podcast.dateReleased} - ${podcast.bibleReference}
            `;
            resultElement.addEventListener('click', () => {
                window.open(podcast.episodeLink, '_blank');
            });
            searchResults.appendChild(resultElement);
        });
    }

    function displaySundaySermonEpisodes(episodes) {
        episodes.forEach(episode => {
            const iframe = document.createElement('iframe');
            iframe.style.borderRadius = '12px';
            iframe.src = episode.link;
            iframe.width = '100%';
            iframe.height = '352';
            iframe.frameBorder = '0';
            iframe.allowFullscreen = true;
            iframe.allow = 'autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture';
            iframe.loading = 'lazy';
            sundaySermonSection.appendChild(iframe);
            sundaySermonSection.appendChild(document.createElement('br'));
        });
    }
});
</script>

        <script>
document.addEventListener("DOMContentLoaded", function() {
    const splashImageSection = document.getElementById('home-image');
    const midImageSection = document.getElementById('mid-image');
    const totalImages = 14; // Total number of images in the folder
    
    // Generate two unique random indices
    let randomIndices = [];
    while (randomIndices.length < 2) {
        let randomIndex = Math.floor(Math.random() * totalImages) + 1;
        if (!randomIndices.includes(randomIndex)) {
            randomIndices.push(randomIndex);
        }
    }

    const homeImageUrl = `./assets/websiteBG-podcasts/${randomIndices[0]}.png`;
    const midImageUrl = `./assets/websiteBG-podcasts/${randomIndices[1]}.png`;

    // Fetch and set the background image for home-image
    fetch(homeImageUrl)
        .then(response => {
            if (response.ok) {
                splashImageSection.style.backgroundImage = `url(${homeImageUrl})`;
            } else {
                console.error('Image not found:', homeImageUrl);
            }
        })
        .catch(error => {
            console.error('Error fetching the image:', error);
        });

    // Fetch and set the background image for mid-image
    fetch(midImageUrl)
        .then(response => {
            if (response.ok) {
                midImageSection.style.backgroundImage = `url(${midImageUrl})`;
            } else {
                console.error('Image not found:', midImageUrl);
            }
        })
        .catch(error => {
            console.error('Error fetching the image:', error);
        });
});
</script>
        <script src="./src/js/function_toggle_mobileMenu.js"></script>

        <script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('podcastSearchInput');
    const searchResults = document.getElementById('searchResults');

    searchInput.addEventListener('input', function() {
        const searchTerm = searchInput.value.toLowerCase();
        const podcastSections = document.querySelectorAll('.inner-page-section');
        let results = [];

        podcastSections.forEach(section => {
            const sectionTitle = section.querySelector('h2').textContent.toLowerCase();
            const episodes = section.querySelectorAll('iframe');

            episodes.forEach(episode => {
                const episodeTitle = episode.getAttribute('src').split('/').pop().split('?')[0];
                if (episodeTitle.includes(searchTerm)) {
                    results.push({ title: episodeTitle, link: episode.getAttribute('src') });
                }
            });
        });

        displaySearchResults(results);
    });

    function displaySearchResults(results) {
        searchResults.innerHTML = '';

        if (results.length > 0) {
            searchResults.style.display = 'block';
            results.forEach(result => {
                const resultItem = document.createElement('div');
                resultItem.classList.add('search-result-item');
                resultItem.innerHTML = `<a href="${result.link}" target="_blank">${result.title}</a>`;
                searchResults.appendChild(resultItem);
            });
        } else {
            searchResults.style.display = 'none';
        }
    }
});
</script>
        <script src="./src/js/fetch-podcast-adult.js"></script>
    </body>
</html>
